---
phase: 09-ai-bdr-agent
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/ai/chat-panel.tsx
  - components/ai/chat-message.tsx
  - components/ai/chat-input.tsx
  - components/ai/tool-result-card.tsx
autonomous: true

must_haves:
  truths:
    - "User can open a chat panel from the main dashboard UI"
    - "User can type a message and see it appear in the chat"
    - "User sees streaming AI response text as it generates"
    - "User sees formatted tool results (investor tables, strategy context) inline in chat"
    - "Chat panel does not block interaction with the rest of the dashboard"
  artifacts:
    - path: "components/ai/chat-panel.tsx"
      provides: "Slide-out chat panel with open/close toggle, message list, and input"
      exports: ["ChatPanel"]
    - path: "components/ai/chat-message.tsx"
      provides: "Individual message renderer for user and assistant messages"
      exports: ["ChatMessage"]
    - path: "components/ai/chat-input.tsx"
      provides: "Chat input with submit button and loading state"
      exports: ["ChatInput"]
    - path: "components/ai/tool-result-card.tsx"
      provides: "Formatted display for tool invocation results (investor tables, strategy data)"
      exports: ["ToolResultCard"]
  key_links:
    - from: "components/ai/chat-panel.tsx"
      to: "/api/chat"
      via: "useChat hook from @ai-sdk/react"
      pattern: "useChat.*api.*chat"
    - from: "components/ai/chat-panel.tsx"
      to: "components/ai/chat-message.tsx"
      via: "renders messages from useChat"
      pattern: "ChatMessage"
    - from: "components/ai/chat-message.tsx"
      to: "components/ai/tool-result-card.tsx"
      via: "renders tool invocation results"
      pattern: "ToolResultCard"
---

<objective>
Build the chat UI components: slide-out panel, message rendering with streaming, tool result display, and input with loading states.

Purpose: This is the user-facing interface for the AI BDR agent. Users interact with the agent through this panel overlaid on the dashboard. It must feel responsive (streaming) and professional (dark theme, investor-grade quality).

Output: Complete set of chat UI components ready to be wired into the dashboard layout.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-ai-bdr-agent/09-RESEARCH.md

Key existing files to reference:
@app/(dashboard)/layout.tsx — Dashboard layout where chat button will be added (in Plan 03)
@components/ui/button.tsx — shadcn/ui Button component
@components/ui/input.tsx — shadcn/ui Input component
@components/ui/card.tsx — shadcn/ui Card component
@components/ui/badge.tsx — shadcn/ui Badge component
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create chat message and tool result components</name>
  <files>
    components/ai/chat-message.tsx
    components/ai/tool-result-card.tsx
  </files>
  <action>
**components/ai/tool-result-card.tsx** — Formatted display for tool results:
- 'use client' component
- Accept `{ toolName: string; result: any; state: string }` props
- Render different layouts based on toolName:
  - `queryPipeline`: Show investor count, summary text, then a compact table with columns: Firm | Stage | Value | Days Inactive | Conviction. Use alternating row colors. Show "N investors found" header.
  - `getInvestorDetail`: Show investor card with firm name as header, stage badge, key fields (est_value, conviction, next_action, next_action_date), contacts list, recent activities list. Use Card component wrapper.
  - `strategyAdvisor`: Show strategy context in a structured card: current stage, days in stage, current strategy notes, key objections, recent activities summary. Use muted background to distinguish from chat text.
- For `state === 'partial-call'` (still loading): show a pulsing skeleton with tool name
- For unknown tools: show JSON.stringify(result, null, 2) in a code block
- Dark theme compatible: use bg-muted, text-foreground, border-border classes
- Compact layout — results should not overwhelm the chat panel width

**components/ai/chat-message.tsx** — Message renderer:
- 'use client' component
- Accept `{ message: UIMessage }` prop (import UIMessage type from 'ai')
- For user messages: right-aligned bubble with bg-primary text-primary-foreground, rounded-lg p-3
- For assistant messages: left-aligned with bg-muted rounded-lg p-3
- Render message parts using `message.parts` array (AI SDK v6 pattern):
  - `part.type === 'text'`: render as markdown-like text (just use whitespace-pre-wrap, no need for full markdown parser)
  - `part.type === 'tool-invocation'` or parts that start with `tool-`: render ToolResultCard with the tool invocation data. Check `part.toolInvocation.state` for 'call' (loading), 'result' (complete).
- Also handle legacy pattern: if `message.toolInvocations` array exists, iterate and render ToolResultCard for each
- Show small timestamp or "AI" / "You" label above each message
- Loading state: if assistant message has no content yet and no parts, show a typing indicator (three animated dots)
  </action>
  <verify>
Run `npx tsc --noEmit` to verify components compile. Visual inspection deferred to Plan 03 checkpoint.
  </verify>
  <done>
ChatMessage renders user and assistant messages with proper styling, handles text and tool invocation parts, and ToolResultCard formats pipeline query results, investor details, and strategy context.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create chat panel and input components</name>
  <files>
    components/ai/chat-panel.tsx
    components/ai/chat-input.tsx
  </files>
  <action>
**components/ai/chat-input.tsx** — Chat input component:
- 'use client' component
- Accept props: `{ value: string; onChange: (value: string) => void; onSubmit: () => void; isLoading: boolean; disabled?: boolean }`
- Textarea (NOT input — allows multiline) with auto-resize up to 4 lines, then scroll
- Use shadcn/ui styling: bg-background border border-border rounded-lg
- Submit button: Send icon (use Lucide `Send` icon) with bg-primary, disabled when empty or loading
- Submit on Enter (without Shift), Shift+Enter for newline
- Placeholder: "Ask about your pipeline..."
- Disabled state during loading with subtle opacity

**components/ai/chat-panel.tsx** — Main chat panel (slide-out overlay):
- 'use client' component
- Accept props: `{ isOpen: boolean; onClose: () => void }`
- Layout: Fixed-position panel on the RIGHT side of screen, 420px wide, full height minus header (top-16 to account for 64px header)
- Slide-in animation: translate-x-full when closed, translate-x-0 when open. Use transition-transform duration-300 ease-in-out.
- Semi-transparent backdrop on left side (bg-black/20) that closes panel on click
- Structure (flex flex-col h-full):
  1. **Header**: "AI BDR Agent" title + close button (X icon). Dark bg-card border-b.
  2. **Messages area**: flex-1 overflow-y-auto, renders ChatMessage for each message. Auto-scroll to bottom on new messages.
  3. **Suggested prompts**: When messages array is empty, show 4-6 clickable suggestion chips:
     - "Show me stalled investors"
     - "Pipeline summary by stage"
     - "High value opportunities"
     - "What needs attention this week?"
     - "Strategy review for [investor]"
     These chips call sendMessage when clicked.
  4. **Input area**: ChatInput component at bottom, border-t

- Use `useChat` hook from `@ai-sdk/react`:
  ```typescript
  import { useChat } from '@ai-sdk/react';

  const { messages, input, setInput, handleSubmit, isLoading, error } = useChat({
    api: '/api/chat',
  });
  ```
  Note: AI SDK v6 useChat may use `sendMessage` instead of `handleSubmit`. Check which is available. The hook connects to /api/chat endpoint automatically.

- Error handling: if `error` is set, show error message in a red-tinted card at bottom of messages area
- Auto-scroll: useEffect with ref on messages container, scroll to bottom when messages change
- z-index: Use z-50 to overlay above dashboard content but below modals (z-[100])

IMPORTANT styling notes:
- Dark theme: bg-card for panel background, text-foreground for text
- Must work with existing Tailwind v4 CSS-first configuration
- Use existing shadcn/ui components (Button, Card) where appropriate
- Panel should feel like a professional sidebar chat, not a popup
  </action>
  <verify>
Run `npx tsc --noEmit` to verify all components compile. Check that useChat import resolves from @ai-sdk/react.
  </verify>
  <done>
ChatPanel renders as a slide-out panel with useChat hook connected to /api/chat, shows suggested prompts when empty, renders streaming messages with tool results, and has a functional input with send button.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes for all 4 new component files
2. ChatPanel uses useChat hook connected to /api/chat
3. ChatMessage handles both text and tool-invocation parts
4. ToolResultCard renders formatted results for all 3 tool types
5. ChatInput handles Enter to submit, Shift+Enter for newline
6. All components use dark theme compatible classes
</verification>

<success_criteria>
- 4 new component files created and compiling
- Chat panel slides in/out with animation
- Messages render with proper user/assistant styling
- Tool results display formatted data (tables, cards)
- Input handles multiline with submit on Enter
- Suggested prompts shown when chat is empty
</success_criteria>

<output>
After completion, create `.planning/phases/09-ai-bdr-agent/09-02-SUMMARY.md`
</output>
