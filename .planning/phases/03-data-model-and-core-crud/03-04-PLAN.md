---
phase: 03-data-model-and-core-crud
plan: 04
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - app/(dashboard)/investors/[id]/page.tsx
  - components/investors/inline-edit-field.tsx
  - components/investors/investor-form-sections.tsx
  - components/investors/contact-list.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all 20 data fields for an investor on the detail page"
    - "User can click any field to edit it directly (inline editing)"
    - "Changes auto-save on blur without requiring a save button"
    - "Fields are organized in collapsible sections (Basic Info, Pipeline Status, Strategy, Activity)"
    - "User can see and manage contacts associated with the investor"
  artifacts:
    - path: "app/(dashboard)/investors/[id]/page.tsx"
      provides: "Investor detail page with all fields"
      min_lines: 40
    - path: "components/investors/inline-edit-field.tsx"
      provides: "Reusable inline edit component for text, number, date, select, boolean, textarea fields"
      exports: ["InlineEditField"]
    - path: "components/investors/investor-form-sections.tsx"
      provides: "Collapsible sections grouping the 20 fields"
      contains: "Collapsible"
    - path: "components/investors/contact-list.tsx"
      provides: "Contact list with add/edit capabilities"
      contains: "contacts"
  key_links:
    - from: "components/investors/inline-edit-field.tsx"
      to: "app/actions/investors.ts"
      via: "Calls updateInvestorField on blur"
      pattern: "updateInvestorField"
    - from: "app/(dashboard)/investors/[id]/page.tsx"
      to: "app/actions/investors.ts"
      via: "Calls getInvestor to load data"
      pattern: "getInvestor"
---

<objective>
Build the investor detail page with inline editing for all 20 fields, organized in collapsible sections, with auto-save on blur.

Purpose: This is where users spend most of their time — viewing and updating investor details. Must feel like Notion/Linear: click to edit, changes save automatically. Critical that non-technical team members can use it confidently.
Output: Full detail page with inline editing, collapsible sections, and contact management.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-data-model-and-core-crud/03-CONTEXT.md
@.planning/phases/03-data-model-and-core-crud/03-RESEARCH.md
@.planning/phases/03-data-model-and-core-crud/03-02-SUMMARY.md
@types/investors.ts
@app/actions/investors.ts
@app/actions/contacts.ts
@lib/validations/investor-schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build InlineEditField component with auto-save on blur</name>
  <files>
    components/investors/inline-edit-field.tsx
  </files>
  <action>
Install shadcn/ui components needed:
```bash
npx shadcn@latest add collapsible accordion tooltip textarea select
```
(Note: some may already be installed. The CLI will skip existing ones.)

**components/investors/inline-edit-field.tsx** — Client component ('use client'):

Build a reusable inline edit component that supports multiple field types. This is the core UX component for the detail page.

Props interface:
```typescript
interface InlineEditFieldProps {
  label: string;
  field: string;           // Database column name
  value: string | number | boolean | null;
  investorId: string;
  type?: 'text' | 'textarea' | 'number' | 'date' | 'select' | 'boolean';
  options?: { value: string; label: string }[];  // For select type
  placeholder?: string;
  formatDisplay?: (value: any) => string;  // Custom display formatting
}
```

Behavior (Notion/Linear style):
1. **Display mode** (default): Shows the field value as text. If value is null/empty, show placeholder in muted color.
2. **Edit mode** (on click): Field transforms into an appropriate input:
   - `text`: shadcn/ui Input
   - `textarea`: shadcn/ui Textarea (auto-resize)
   - `number`: Input with type="number"
   - `date`: Input with type="date"
   - `select`: shadcn/ui Select or native select with options
   - `boolean`: Toggle/checkbox
3. **Save on blur**: When user clicks away or presses Tab:
   - If value changed, call `updateInvestorField(investorId, field, newValue)`
   - Show brief saving indicator (subtle spinner or "Saving..." text)
   - On success: return to display mode with new value
   - On error: show inline error message, keep in edit mode
4. **Save on Enter** (for text/number): pressing Enter saves and exits edit mode
5. **Cancel on Escape**: pressing Escape reverts to original value and exits edit mode

Visual design:
- Display mode: text with subtle hover effect (background change) to indicate clickable
- Edit mode: input with focus ring, slightly different background
- Saving state: subtle opacity change or small spinner next to field
- Error state: red border + error message below
- Label always visible above the field value, small/muted text

Currency formatting for est_value: Display as "$1,000,000" but edit as raw number. Use Intl.NumberFormat for display, parse on save.

Date formatting: Display as "Jan 15, 2026" but edit with date picker input. Store as ISO date string.

Boolean fields (stalled): Show as a toggle switch or checkbox, save immediately on change (no blur needed).

IMPORTANT: Each InlineEditField manages its own local state. Do NOT use a single form for the entire page. This prevents one field's validation from blocking another field's save.
  </action>
  <verify>
Read the component file. Verify: (1) Supports all 6 field types, (2) Calls updateInvestorField on blur, (3) Has display mode and edit mode, (4) Handles Enter to save and Escape to cancel, (5) Shows saving/error states, (6) Does NOT use a shared form context. Run `npx tsc --noEmit`.
  </verify>
  <done>InlineEditField component handles 6 field types with click-to-edit, auto-save on blur, keyboard shortcuts, and error handling</done>
</task>

<task type="auto">
  <name>Task 2: Build investor detail page with collapsible sections and contacts</name>
  <files>
    app/(dashboard)/investors/[id]/page.tsx
    components/investors/investor-form-sections.tsx
    components/investors/contact-list.tsx
  </files>
  <action>
**app/(dashboard)/investors/[id]/page.tsx** — Server component:
- Extract `id` from params (Next.js 16 dynamic route: `params` is a Promise, must await it)
- Call `getInvestor(id)` server action
- If not found, show 404 or redirect to /investors
- Render page header with: investor firm_name as page title, back link to /investors, delete button (wired in Plan 05)
- Render `InvestorFormSections` with the investor data
- Render `ContactList` with contacts data

**components/investors/investor-form-sections.tsx** — Client component ('use client'):

Accept `investor: InvestorWithContacts` prop.

Organize all 20 fields into 4 collapsible sections using shadcn/ui Collapsible:

**Section 1: Basic Info** (default open):
- Firm Name (text, required indicator)
- Relationship Owner (text, required indicator)
- Partner / Source (text)
- Allocator Type (select, options from ALLOCATOR_TYPES)
- Est. Value (number, currency formatting)

**Section 2: Pipeline Status** (default open):
- Stage (select, options from INVESTOR_STAGES, required indicator)
- Entry Date (date)
- Last Action Date (date)
- Stalled (boolean toggle)
- Internal Conviction (select: 'Low' | 'Medium' | 'High')
- Internal Priority (select: 'Low' | 'Medium' | 'High' | 'Critical')
- Investment Committee Timing (text)

**Section 3: Strategy** (default open):
- Current Strategy Notes (textarea)
- Current Strategy Date (date)
- Last Strategy Notes (textarea, slightly muted — historical)
- Last Strategy Date (date, slightly muted)
- Key Objection / Risk (textarea)

**Section 4: Next Steps** (default open):
- Next Action (text)
- Next Action Date (date)

Each section has:
- Collapsible header with section name and expand/collapse chevron
- Grid layout inside: 2 columns on desktop, 1 on mobile (responsive)
- Each field rendered as `<InlineEditField>` with appropriate type and options

Section header styling: border-b, uppercase text-xs tracking-wide, muted foreground. Clean, professional, not decorative.

**components/investors/contact-list.tsx** — Client component ('use client'):

Accept `contacts: Contact[]` and `investorId: string` props.

Display contacts as compact cards:
- Primary contact shown first with a "Primary" badge
- Each contact shows: name, title, email, phone
- "Add Contact" button opens inline form (not modal — keep it simple)
- Inline add form: name (required), email, phone, title fields
- Submit calls createContact server action
- Contact email shown as mailto link, phone as tel link

Keep contact management simple for Phase 3 — Phase 6 (Activity Management) will enhance this with full contact editing.
  </action>
  <verify>
Read all files. Verify: (1) Detail page awaits params and calls getInvestor, (2) All 20 fields appear in the form sections, (3) Fields use correct InlineEditField types (text, number, date, select, textarea, boolean), (4) 4 collapsible sections exist with correct field groupings, (5) ContactList renders contacts with add capability, (6) Page handles investor not found. Run `npx tsc --noEmit`.
  </verify>
  <done>Detail page at /investors/[id] shows all 20 fields in 4 collapsible sections with inline editing, auto-save on blur, and contact management</done>
</task>

</tasks>

<verification>
- Navigate to /investors/[id] — page renders all 20 fields organized in 4 sections
- Click any text field — transforms to input, saves on blur
- Click a select field — shows dropdown with options
- Toggle stalled boolean — saves immediately
- Edit est_value — displays as currency, edits as number
- Contacts section shows contacts with primary badge
- Add contact form creates new contact
- All fields match the CONTEXT.md field list exactly
- `npx tsc --noEmit` passes
</verification>

<success_criteria>
- All 20 investor data fields editable via inline editing
- Auto-save on blur works without save button
- 4 collapsible sections organize fields logically
- Contact list with add capability works
- Page handles missing investor gracefully
- Non-technical users can understand the interface (clean, labeled, no jargon)
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-model-and-core-crud/03-04-SUMMARY.md`
</output>
