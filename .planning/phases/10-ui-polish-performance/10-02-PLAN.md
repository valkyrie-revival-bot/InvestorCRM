---
phase: 10-ui-polish-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/page.tsx
  - app/actions/investors.ts
  - lib/hooks/use-nav-active.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard shows real investor counts by stage and total pipeline value"
    - "Dashboard provides at-a-glance pipeline intelligence (stalled count, next actions due)"
    - "Navigation indicates current active page"
  artifacts:
    - path: "app/(dashboard)/page.tsx"
      provides: "Dashboard with real data fetched from Supabase"
      min_lines: 60
    - path: "app/actions/investors.ts"
      provides: "getInvestors action (already exists, used by dashboard)"
      contains: "getInvestors"
  key_links:
    - from: "app/(dashboard)/page.tsx"
      to: "app/actions/investors.ts"
      via: "Server action call for pipeline data"
      pattern: "getInvestors"
---

<objective>
Build a data-driven dashboard that shows real pipeline metrics and add active page indication to navigation.

Purpose: The dashboard is the landing page after login and currently shows static zeros. For the investor demo, it must immediately convey pipeline health with real data. Navigation active states help users orient themselves within the application.
Output: Dashboard with real metrics cards, active nav link styling.
</objective>

<execution_context>
@/Users/RAZER/.claude/get-shit-done/workflows/execute-plan.md
@/Users/RAZER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/(dashboard)/page.tsx
@app/actions/investors.ts
@components/ai/dashboard-chat-wrapper.tsx
@lib/stage-definitions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build data-driven dashboard with pipeline metrics</name>
  <files>app/(dashboard)/page.tsx</files>
  <action>
Replace the static dashboard page with a server component that fetches real investor data and displays meaningful metrics.

Import `getInvestors` from `@/app/actions/investors` and `computeIsStalled` from `@/lib/stage-definitions`.

Fetch investors data at page level (same pattern as investors/page.tsx). Compute these metrics:
- `totalInvestors`: count of all investors
- `activeInvestors`: count where stage is NOT 'Won', 'Lost', 'Passed', or 'Delayed'
- `stalledCount`: count where `computeIsStalled(inv.last_action_date, inv.stage)` returns true
- `totalPipelineValue`: sum of all `est_value` fields (use 0 for null)
- `nextActionsDue`: count of investors where `next_action_date` is within the next 7 days (use `new Date()` and compare)
- `stageCounts`: object mapping stage name to count (for a mini stage breakdown)

Layout the dashboard with:

1. **Header section:** "Dashboard" title with "Pipeline Intelligence at a glance" subtitle

2. **Top row of 4 metric cards** using shadcn/ui Card:
   - "Total Investors" with count and "in pipeline" subtitle
   - "Active Deals" with activeInvestors count and "being worked" subtitle
   - "Stalled" with stalledCount and "needs attention" subtitle — use `text-orange-400` for count if > 0
   - "Pipeline Value" with formatted totalPipelineValue (use `Intl.NumberFormat` with compact notation for millions) and "estimated" subtitle

3. **Second row of 2 cards:**
   - "Next Actions Due" with nextActionsDue count and "within 7 days" subtitle — use `text-brand-primary` (or fall back to `text-blue-400`) for emphasis if > 0
   - "Stage Breakdown" — a mini horizontal bar or simple list of stage name: count pairs, styled as text rows with the stage count right-aligned

4. **Quick actions row:** Two buttons:
   - "View Pipeline" linking to `/investors` (use Next.js Link)
   - "Add Investor" that... no, just link. Keep it simple.

Use Lucide icons for each card: `Users` for total, `TrendingUp` for active, `AlertTriangle` for stalled, `DollarSign` for value, `CalendarClock` for next actions, `BarChart3` for breakdown.

Format large numbers: use `Intl.NumberFormat('en-US', { notation: 'compact', maximumFractionDigits: 1 })` for values over 1000.

Handle error state gracefully: if getInvestors returns error, show error message card.
Handle empty state: if no investors, show a welcoming message with a link to create the first investor.

WHY: Dashboard must demonstrate pipeline intelligence at a glance. Static zeros make the app look like a prototype. Real data makes it look like a production tool.
  </action>
  <verify>
Run `npm run build` to confirm server component compiles correctly.
Grep for "getInvestors" in app/(dashboard)/page.tsx to confirm data fetch.
Grep for "computeIsStalled" in app/(dashboard)/page.tsx to confirm stalled calculation.
  </verify>
  <done>Dashboard fetches real investor data and displays total count, active deals, stalled count, pipeline value, next actions due, and stage breakdown in professionally styled metric cards</done>
</task>

<task type="auto">
  <name>Task 2: Add active page indication to navigation</name>
  <files>components/ai/dashboard-chat-wrapper.tsx</files>
  <action>
The DashboardChatWrapper is a client component ('use client'), so we CAN use `usePathname()` from 'next/navigation' to detect the current route and highlight the active nav link.

1. Import `usePathname` from 'next/navigation' at the top of the file.

2. Inside the component function, call `const pathname = usePathname()`.

3. Create a helper function or inline check for active state:
```tsx
const isActive = (href: string) => {
  if (href === '/') return pathname === '/';
  return pathname.startsWith(href);
};
```

4. Update each nav Link to conditionally apply active styling:
```tsx
<Link
  href="/investors"
  className={cn(
    "text-sm font-medium px-3 py-2 rounded-md transition-colors",
    isActive('/investors')
      ? "text-foreground bg-accent"
      : "text-muted-foreground hover:text-foreground hover:bg-accent/50"
  )}
>
  Pipeline
</Link>
```

5. Add a "Dashboard" link at the beginning of nav links pointing to "/" with the same active pattern.

6. Import `cn` from `@/lib/utils` if not already imported.

WHY: Active nav states are a fundamental UX pattern. Without them, users can't tell where they are in the application. The DashboardChatWrapper already uses `useState` so adding `usePathname` has no performance cost.

Note: If this plan runs in parallel with Plan 01 which also modifies dashboard-chat-wrapper.tsx, the executor should ensure both sets of changes are present. Plan 01 handles brand styling; Plan 02 handles navigation behavior. They modify different parts of the same file but don't conflict since one is visual (classes, brand text) and the other is behavioral (usePathname, active states, Dashboard link).
  </action>
  <verify>
Run `npm run build` to confirm no errors.
Grep for "usePathname" in dashboard-chat-wrapper.tsx to confirm pathname hook.
Grep for "isActive" in dashboard-chat-wrapper.tsx to confirm active state logic.
  </verify>
  <done>Navigation shows active state for current page (highlighted background + foreground color), Dashboard link added to nav</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Dashboard page imports and calls getInvestors (real data fetch)
3. Navigation has usePathname-based active state detection
4. Dashboard displays metric cards with dynamic values
</verification>

<success_criteria>
- Dashboard shows real investor counts, pipeline value, stalled count, next actions due
- Navigation indicates which page is currently active
- Empty state handled gracefully when no investors exist
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-ui-polish-performance/10-02-SUMMARY.md`
</output>
